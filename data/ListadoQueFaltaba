create function [MM].[DestinosAeronavesMenosVendidos]
(@semestre int,
@anio char(4))
returns @table table
(Description varchar(100))
as
begin
declare @desde char(4)
declare @hasta char(4)
if @semestre=1
begin
set @desde='0101'
set @hasta='0530'
end
if @semestre=2
begin
set @desde='0601'
set @hasta='1231'
end
insert into @table  
select top 5 d.Descripcion
from MM.Butacas a,MM.Viajes b, MM.Rutas_Aereas c, MM.Ciudades d
where a.Viaje=b.Id and b.Ruta=c.Ciudad_Destino and c.Ciudad_Destino=d.Id
and b.Fecha_salida
between @anio+@desde and @anio+@hasta 
group by d.Descripcion
order by count(*) desc 
return
end

GO
